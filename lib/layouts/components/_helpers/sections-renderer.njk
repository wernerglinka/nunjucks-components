{% from "components/_helpers/build-container-attributes.njk" import buildContainerAttributes %}
{% from "components/_helpers/render-section.njk" import renderSection %}

{#
  firstSectionClass may be set before including this renderer:
  - 'first-section' (default) for regular pages
  - 'first-text-section' for sidebar layouts
#}

{#
    Build context object with all data needed by section components

    Note: urlPath is generated by the metalsmith-menu-plus plugin
    Note: Navigation (previous/next) is accessed via collection[name].previous/next
#}
{% set context = {
  data: data,
  collections: collections,
  urlPath: urlPath,
  collection: collection,
  crumbs: navigation.breadcrumbs
} %}


{# loop through all sections and render them #}
{% for section in sections %}
  {# don't render section if disabled in frontmatter #}
  {% if not section.isDisabled %}

    {# section wrapper may be article, aside, section or div depending on section.containerTag setting #}
    <{{ section.containerTag }} id="{{ section.id }}"  {{ buildContainerAttributes(section, loop.first, firstSectionClass) }}>

      {# if section has background add a background image #}
      {% if section.containerFields.background.image %}
        <div class="background-image" style="background-image: url({{ section.containerFields.background.image }})"></div>
      {% endif %}

      {# section content #}
      {{ renderSection(section, context) }}

      {% set containerTag = section.containerTag %}
    </{{ containerTag }}>

  {% endif %}
{% else %}
  <p class="error-message">There are no sections available</p>
{% endfor %}